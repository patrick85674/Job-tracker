{% extends 'main.html' %}
{% load i18n %}
{% block main %}

<h3>{% translate "Applications:" %}</h3>

<div>
    <form method="get" class="filter-form">
        <label>{% translate "Status" %}:
            <select name="status">
                <option value="">{% translate "All" %}</option>
                {% for key, value in status_choices %}
                    <option value="{{ key }}" {% if filters.status == key|stringformat:"s" %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
            </select>
        </label>

        <label>{% translate "Job name" %}:
            <input type="text" name="jobname" value="{{ filters.jobname }}">
        </label>

        <label>{% translate "Date from" %}:
            <input type="date" name="date_from" value="{{ filters.date_from }}">
        </label>

        <label>{% translate "Date to" %}:
            <input type="date" name="date_to" value="{{ filters.date_to }}">
        </label>

        <label>{% translate "Sort by" %}:
            <select name="sort">
                <option value="">{% translate "Default" %}</option>
                <option value="status" {% if filters.sort == "status" %}selected{% endif %}>{% translate "Status" %}</option>
                <option value="created_at" {% if filters.sort == "created_at" %}selected{% endif %}>{% translate "Created Date" %}</option>
                <option value="job__job_name" {% if filters.sort == "job__job_name" %}selected{% endif %}>{% translate "Job Name" %}</option>
                <option value="job__company_name" {% if filters.sort == "job__company_name" %}selected{% endif %}>{% translate "Company Name" %}</option>
            </select>
        </label>

        <button type="submit">{% translate "Apply" %}</button>
    </form>

    <!-- Top report buttons -->
    <div class="report-buttons">
        <a href="{% url 'application:application_report' %}?{{ request.GET.urlencode }}&type=pdf">
            {% translate "Download PDF" %}
        </a>
        <a href="{% url 'application:application_report' %}?{{ request.GET.urlencode }}&type=xlsx">
            {% translate "Download XLSX" %}
        </a>
    </div>

    {% for application in page_obj.object_list %}
        <div class="application-card">
            <h2>{{ application.job.job_name }}</h2>
            <p>{{ application.get_status_display }}</p>
        </div>
    {% empty %}
        <p>{% translate "No application available." %}</p>
    {% endfor %}

    <!-- Bottom report buttons -->
    <div class="report-buttons">
        <a href="{% url 'application:application_report' %}?{{ request.GET.urlencode }}&type=pdf">
            {% translate "Download PDF" %}
        </a>
        <a href="{% url 'application:application_report' %}?{{ request.GET.urlencode }}&type=xlsx">
            {% translate "Download XLSX" %}
        </a>
    </div>

    <div class="pagination">
        <span class="page-info">
            {% translate "Page" %} {{ page_obj.number }} {% translate "of" %} {{ page_obj.paginator.num_pages }}
        </span>

        <ul class="pagination-list">
            {% if page_obj.has_previous %}
                <li><a href="?page=1&{{ request.GET.urlencode|urlencode }}">{% translate "&laquo; First" %}</a></li>
                <li><a href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode|urlencode }}">{% translate "‹ Back" %}</a></li>
            {% else %}
                <li class="disabled">{% translate "&laquo; First" %}</li>
                <li class="disabled">{% translate "‹ Back" %}</li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                    <li class="active">{{ num }}</li>
                {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
                    <li><a href="?page={{ num }}&{{ request.GET.urlencode|urlencode }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li><a href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode|urlencode }}">{% translate "Next ›" %}</a></li>
                <li><a href="?page={{ page_obj.paginator.num_pages }}&{{ request.GET.urlencode|urlencode }}">{% translate "Last &raquo;" %}</a></li>
            {% else %}
                <li class="disabled">{% translate "Next ›" %}</li>
                <li class="disabled">{% translate "Last &raquo;" %}</li>
            {% endif %}
        </ul>
    </div>
</div>

{% endblock %}