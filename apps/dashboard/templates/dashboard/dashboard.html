
{% extends "main.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block app-styles %}

<link href="{% static 'dashboard/css/dashboard.css' %}" rel="stylesheet" />
{% endblock %}

{% block main %}

<h1>Welcome, {{ request.user.username }}</h1>

<!-- Watchlist-->
<div class="job-box">
  <section>
    <h2>Your Jobs</h2>

    <!-- Filter input -->
    <input type="text" name="q" placeholder="Filter jobs..."
      hx-get="{% url 'watchlist:watch_list_partial' %}"
      hx-trigger="keyup changed delay:500ms"
      hx-target="#watch-list"
      hx-swap="innerHTML"
      class="filter-input">

    <div id="watch-list">
      {% include "partials/watchlist_list.html" %}
    </div>

    <!-- Button to toggle form -->
    <button
      hx-get="{% url 'watchlist:add_job_to_watchlist' %}"
      hx-target="#job-form-container"
      hx-swap="outerHTML"
      type="button">
      + Add Job
    </button>

    

    <!-- Form will be dynamically loaded here -->
    <div id="job-form-container"></div>

  </section>
</div>

<!-- Application list-->
<div class="application-box">
  <section>
    <h2>Your Applications</h2>

    <!-- Filter input -->
    <input type="text" name="q" placeholder="Filter applications..."
      hx-get="{% url 'application:application_list_partial' %}"
      hx-trigger="keyup changed delay:500ms"
      hx-target="#application-list"
      hx-swap="innerHTML"
      class="filter-input">

    <div id="application-list">
      {% include "partials/application_list_partial.html" %}
    </div>

    <!-- Edit Button -->
    <button
        hx-get="{% url 'application:application_add_modal'%}"
        hx-target="#modal-body"
        hx-swap="innerHTML">
        Add
    </button>

    <!-- Button to toggle form -->
    <button
      hx-get="{% url 'application:application_add' %}"
      hx-target="#application-form-container"
      hx-swap="outerHTML"
      type="button">
      + Add Application
    </button>

    <!-- Form will be dynamically loaded here -->
    <div id="application-form-container"></div>

  </section>
</div>

<!-- Modal -->
<div id="modal" class="modal" style="display:none;">
  <div class="modal-content" id="modal-body"></div>
</div>

<script src="{% static 'dashboard/js/modal.js' %}"></script>


{% endblock %}

{% block extra_scripts %}
<script>
  // Reset and hide form container after successful HTMX request
  document.body.addEventListener("htmx:afterRequest", function (evt) {
    if (evt.detail.target.id === "job-form-container") {
      document.getElementById("job-form-container").innerHTML = "";
    }
  });
</script>

<script>
  // Reset and hide form container after successful HTMX request
  document.body.addEventListener("htmx:afterRequest", function (evt) {
    if (evt.detail.target.id === "application-form-container") {
      document.getElementById("application-form-container").innerHTML = "";
    }
  });
</script>

{% endblock %}
