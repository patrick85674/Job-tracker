{% extends "main.html" %}

{% block title %}Dashboard{% endblock %}


{% block main %}
  <h1>Welcome, {{ request.user.username }}</h1>

  <div class="job-box">
    <section>
      <h2>Your Jobs</h2>

      <!-- Filter input -->
      <input type="text" name="q" placeholder="Filter jobs..." 
             hx-get="{% url 'watchlist:watch_list_partial' %}" 
             hx-trigger="keyup changed delay:500ms"
             hx-target="#watch-list"
             hx-swap="innerHTML"
             class="filter-input">

      <div id="watch-list">
        {% include "partials/watchlist_list.html" %}
      </div>
      
      <!-- Button to toggle form -->
      <button 
        hx-get="{% url 'watchlist:add_job_to_watchlist' %}" 
        hx-target="#job-form-container" 
        hx-swap="outerHTML"
        type="button"
      >
        + Add Job
      </button>

      <!-- Form will be dynamically loaded here -->
      <div id="job-form-container"></div>

    </section>
  </div>
{% endblock %}

{% block extra_scripts %}
<script>
  // Reset and hide form container after successful HTMX request
  document.body.addEventListener("htmx:afterRequest", function (evt) {
    if (evt.detail.target.id === "job-form-container") {
      document.getElementById("job-form-container").innerHTML = "";
    }
  });
</script>
{% endblock %}
